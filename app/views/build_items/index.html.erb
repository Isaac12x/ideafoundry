<div class="backlog-page">
  <div class="backlog-header">
    <div class="backlog-header-text">
      <h2>Backlog</h2>
      <p class="backlog-subtitle">Prioritize what to build next</p>
      <% total = @build_items.size + @completed_items.size %>
      <% if total > 0 %>
        <div class="backlog-progress">
          <div class="backlog-progress-track">
            <div class="backlog-progress-fill" style="width: <%= (@completed_items.size.to_f / total * 100).round %>%"></div>
          </div>
          <span class="backlog-progress-label"><%= (@completed_items.size.to_f / total * 100).round %>%</span>
        </div>
      <% end %>
    </div>
    <div class="backlog-stats">
      <span class="backlog-stat">
        <span class="backlog-stat-num"><%= @build_items.size %></span>
        <span class="backlog-stat-label">queued</span>
      </span>
      <span class="backlog-stat-divider"></span>
      <span class="backlog-stat">
        <span class="backlog-stat-num"><%= @completed_items.size %></span>
        <span class="backlog-stat-label">done</span>
      </span>
    </div>
  </div>

  <div id="build_item_form" class="backlog-add-section">
    <%= render "form", build_item: @build_item %>
  </div>

  <div id="build_items_list"
       class="backlog-list"
       data-controller="build-item-sort"
       data-build-item-sort-url-value="<%= reorder_build_items_path %>">
    <% @build_items.each_with_index do |item, i| %>
      <%= render "build_item", build_item: item, index: i %>
    <% end %>

    <% if @build_items.empty? %>
      <div id="build_items_empty" class="backlog-empty">
        <div class="backlog-empty-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><path d="M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
        </div>
        <h3>Nothing queued yet</h3>
        <p>Add your first item above to start building your backlog.</p>
      </div>
    <% end %>
  </div>

  <% if @completed_items.any? %>
    <div class="backlog-completed-section" data-controller="completed-toggle">
      <button class="backlog-completed-toggle" data-action="click->completed-toggle#toggle">
        <svg class="chevron-icon" data-completed-toggle-target="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        <span>Completed</span>
        <span class="backlog-completed-count"><%= @completed_items.size %></span>
      </button>

      <div class="completed-items" data-completed-toggle-target="list" id="completed_build_items">
        <% @completed_items.each_with_index do |item, i| %>
          <%= render "build_item", build_item: item, index: i %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
