<div class="settings-container">
  <div class="page-header">
    <h2>Topology & Graph Settings</h2>
    <div class="header-actions">
      <%= link_to settings_path, class: "btn btn-sm" do %>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Back to Settings
      <% end %>
      <%= link_to topologies_path, class: "btn btn-sm" do %>
        Manage Topologies
      <% end %>
    </div>
  </div>

  <%= form_with url: settings_topologies_path, method: :patch, local: true do |form| %>

    <!-- Graph Visuals -->
    <div class="config-section">
      <h3>Graph Visuals</h3>
      <p class="config-description">Default visual settings for the 3D topology graph.</p>

      <div class="weight-grid">
        <div class="weight-item">
          <label class="weight-label">
            Layout Mode
            <span class="weight-description">Default graph layout when opened</span>
          </label>
          <%= form.select "topology_settings[default_dag_mode]",
              options_for_select([["Tree (top-down)", "td"], ["Force-directed (free)", ""]], @topology_settings['default_dag_mode']),
              {}, class: "form-control" %>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Show Ideas
            <span class="weight-description">Display idea nodes in the graph by default</span>
          </label>
          <%= form.select "topology_settings[show_ideas]",
              options_for_select([["Yes", "true"], ["No", "false"]], @topology_settings['show_ideas'].to_s),
              {}, class: "form-control" %>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Topology Node Size
            <span class="weight-description">Base size of topology nodes (1-15)</span>
          </label>
          <div class="weight-input-group">
            <%= form.number_field "topology_settings[node_size_topology]",
                value: @topology_settings['node_size_topology'],
                min: 1, max: 15, step: 1, class: "weight-input" %>
          </div>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Idea Node Size
            <span class="weight-description">Base size of idea nodes (1-10)</span>
          </label>
          <div class="weight-input-group">
            <%= form.number_field "topology_settings[node_size_idea]",
                value: @topology_settings['node_size_idea'],
                min: 1, max: 10, step: 1, class: "weight-input" %>
          </div>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Bloom Strength
            <span class="weight-description">Glow intensity (0 = off, 2 = max)</span>
          </label>
          <div class="weight-input-group">
            <%= form.number_field "topology_settings[bloom_strength]",
                value: @topology_settings['bloom_strength'],
                min: 0, max: 2, step: 0.1, class: "weight-input" %>
          </div>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Fog Density
            <span class="weight-description">Atmospheric fog (0 = clear, 0.05 = dense)</span>
          </label>
          <div class="weight-input-group">
            <%= form.number_field "topology_settings[fog_density]",
                value: @topology_settings['fog_density'],
                min: 0, max: 0.05, step: 0.001, class: "weight-input" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Graph Behavior -->
    <div class="config-section">
      <h3>Graph Behavior</h3>
      <p class="config-description">How the graph responds to interactions.</p>

      <div class="weight-grid">
        <div class="weight-item">
          <label class="weight-label">
            Auto-Fit on Load
            <span class="weight-description">Zoom to fit all nodes when graph loads</span>
          </label>
          <%= form.select "topology_settings[auto_fit_on_load]",
              options_for_select([["Yes", "true"], ["No", "false"]], @topology_settings['auto_fit_on_load'].to_s),
              {}, class: "form-control" %>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Click Behavior
            <span class="weight-description">What happens when you click a node</span>
          </label>
          <%= form.select "topology_settings[click_behavior]",
              options_for_select([["Navigate to page", "navigate"], ["Focus camera", "focus"]], @topology_settings['click_behavior']),
              {}, class: "form-control" %>
        </div>
      </div>
    </div>

    <!-- Topology Defaults -->
    <div class="config-section">
      <h3>Topology Defaults</h3>
      <p class="config-description">Defaults applied when creating new topologies.</p>

      <div class="weight-grid">
        <div class="weight-item">
          <label class="weight-label">
            Default Color
            <span class="weight-description">Color for new topologies</span>
          </label>
          <%= form.color_field "topology_settings[default_color]",
              value: @topology_settings['default_color'],
              class: "form-control", style: "width: 60px;" %>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Default Type
            <span class="weight-description">Type assigned to new topologies</span>
          </label>
          <%= form.select "topology_settings[default_type]",
              options_for_select([["Custom", "custom"], ["Predefined", "predefined"]], @topology_settings['default_type']),
              {}, class: "form-control" %>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Max Depth
            <span class="weight-description">Maximum nesting depth for hierarchies</span>
          </label>
          <div class="weight-input-group">
            <%= form.number_field "topology_settings[max_depth]",
                value: @topology_settings['max_depth'],
                min: 1, max: 20, step: 1, class: "weight-input" %>
          </div>
        </div>

        <div class="weight-item">
          <label class="weight-label">
            Sort Order
            <span class="weight-description">Default sort for topology lists</span>
          </label>
          <%= form.select "topology_settings[sort_order]",
              options_for_select([["Position (manual)", "position"], ["Name (A-Z)", "name"], ["Ideas count", "ideas_count"]], @topology_settings['sort_order']),
              {}, class: "form-control" %>
        </div>
      </div>
    </div>

    <!-- Display Preferences -->
    <div class="config-section">
      <h3>Display Preferences</h3>
      <p class="config-description">How topologies are displayed by default.</p>

      <div class="weight-grid">
        <div class="weight-item">
          <label class="weight-label">
            Default View
            <span class="weight-description">Initial view when opening the topologies page</span>
          </label>
          <%= form.select "topology_settings[default_view]",
              options_for_select([["Tree view", "tree"], ["Graph view", "graph"]], @topology_settings['default_view']),
              {}, class: "form-control" %>
        </div>
      </div>
    </div>

    <div class="config-actions">
      <%= form.submit "Save Settings", class: "btn btn-primary" %>
      <%= link_to "Reset to Defaults", settings_topologies_path,
          method: :patch,
          params: { topology_settings: User::DEFAULT_TOPOLOGY_SETTINGS },
          class: "btn btn-secondary",
          data: { turbo_confirm: "Reset all topology settings to defaults?" } %>
    </div>
  <% end %>
</div>
